\chapter{Модуль взаимодействия с API ruz.spbstu.ru}\label{appendix-api}	

\begin{lstlisting}
public class ApiRuz {
	public Set<Rasp> rasp;
	public Set<Rasp> raspPI;
	public Set<Rasp> raspMO;
	public List<Group> pi;
	public List<Group> mo;
	
			public ApiRuz() {
				raspPI = new HashSet<>();
				raspMO = new HashSet<>();
				rasp = new HashSet<>();
				pi = new ArrayList<>();
				mo = new ArrayList<>();
				RuzSpbStu.getGroupsbyFacultyId(95).forEach(x -> {
					if (x.getNameGroup().startsWith("3530903/") ) {
								pi.add(x);
							}
							if (x.getNameGroup().startsWith("3530203/")){
										mo.add(x);
									}
								});
								for (Group g : pi) {
									int idGroup = g.getIdGroup();
									String groupName = g.getNameGroup();
									int level = g.getLevel();
									for (int i = 0; i < 3; i++) {
										java.util.ArrayList<Day> days = RuzSpbStu.getScheduleByGroupIdAndDate(idGroup, LocalDate.now().minusWeeks(i)).getDays();
										for (Day d : days) {
											List<Lesson> lessons = d.getLessons();
											for (Lesson x : lessons) {
												String sub = x.getSubject();
												List<Teacher> t = x.getTeachers();
												if (t != null) {
													Set<String> set = new HashSet<>();
													for (Teacher te : t) {
														set.add(te.getFullName());
													}
													Rasp r = new Rasp(set, groupName, sub, level);
													if (raspPI.contains(r)) {
														for (Rasp y : raspPI) {
															if (y.equals(r)) {
																Set<String> n = y.teacherName;
																set.addAll(n);
																raspPI.remove(y);
																break;
															}
														}
													}
													Rasp ra = new Rasp(set, groupName, sub, level);
													raspPI.remove(ra);
													raspPI.add(ra);
													rasp.remove(ra);
													rasp.add(ra);
												}
											}
										}
									}
								}
								
								for (Group g : mo) {
									int idGroup = g.getIdGroup();
									String groupName = g.getNameGroup();
									int level = g.getLevel();
									for (int i = 0; i < 3; i++) {
										java.util.ArrayList<com.fleshka4.spbstu.ruz.api.models.Day> days = RuzSpbStu.getScheduleByGroupIdAndDate(idGroup, LocalDate.now().minusWeeks(i))
										.getDays();
										for (Day d : days) {
											List<Lesson> lessons = d.getLessons();
											for (Lesson x : lessons) {
												String sub = x.getSubject();
												List<Teacher> t = x.getTeachers();
												if (t != null) {
													Set<String> set = new HashSet<>();
													for (Teacher te : t) {
														set.add(te.getFullName());
													}
													Rasp r = new Rasp(set, groupName, sub, level);
													if (raspMO.contains(r)) {
														for (Rasp y : raspMO) {
															if (y.equals(r)) {
																Set<String> n = y.teacherName;
																set.addAll(n);
																break;
															}
														}
													}
													Rasp ra = new Rasp(set, groupName, sub, level);
													raspMO.remove(ra);
													raspMO.add(ra);
													rasp.remove(ra);
													rasp.add(ra);
												}
											}
										}
									}
								}
								
								raspMO.forEach(System.out::println);
								raspPI.forEach(System.out::println);
							}
							
							public Map<String, Integer> getTeachersNames() {
								Map<String, Integer> names = new HashMap<>();
								for (Rasp r : raspPI) {
									r.teacherName.forEach(t -> names.put(t, names.getOrDefault(t, 0)));
								}
								for (Rasp r : raspMO) {
									r.teacherName.forEach(t -> names.put(t, names.getOrDefault(t, 0)));
								}
								return names;
							}
						}
\end{lstlisting}		